<!DOCTYPE html>
<html lang="en"> 
  <main> 
    <header>
    <div class="box-shadow">
    <nav class="nav-wrapper">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="MSTLP.htm">MMM Level Packs</a></li>
        <li><a href="MSTLevels.htm">MST Levels</a></li>
        <li><a href="Speedruns.htm">Speedruns</a></li>
        <li><a href="Account.html">Account</a></li>
        <li><a href="Login.html">Login</a></li>
      </ul>
    </nav>
    </div>
    </header>
    <body>
      <div class="loginBlock">
      <div class="wrapper">
        <div class="title-text">
          <div class="title login">Login</div>
          <div class="title signup">Signup</div>
        </div>
        <div class="form-container">
          <div class="slide-controls">
            <input type="radio" name="slide" id="login" checked>
            <input type="radio" name="slide" id="signup">
            <label for="login" class="slide login">Login</label>
            <label for="signup" class="slide signup">Signup</label>
            <div class="slider-tab"></div>
          </div>
          <div class="form-inner">
            <!-- Login Form -->
            <form id="loginForm" action="#" class="login" onsubmit="event.preventDefault();">
              <div class="field">
                <input type="text" placeholder="Username" id="loginUsername" required>
              </div>
              <div class="field">
                <input type="password" placeholder="Password" id="loginPassword" required>
              </div>
              <!-- Hidden field to store encrypted password -->
              <input type="hidden" id="loginEncryptedPassword" name="loginEncryptedPassword">
              <div class="pass-link"><a href="#"></a></div>
              <div class="field btn">
                <div class="btn-layer"></div>
                <input type="submit" value="Login">
              </div>
              <div class="signup-link">Not a member? <a href="">Signup now</a></div>
              <div class= "signup-link" id="statusMessage"></div>
            </form>
            <!-- Signup Form -->
            <form id="signupForm" action="#" class="signup" onsubmit="event.preventDefault(); encryptPassword('signup');">
              <div class="field">
                <input type="text" placeholder="Username" id="signupUsername" required>
              </div>
              <div class="field">
                <input type="password" placeholder="Password" id="signupPassword" required>
              </div>
              <div class="field">
                <input type="password" placeholder="Confirm password" required>
              </div>
              <!-- Hidden field to store encrypted password -->
              <input type="hidden" id="signupEncryptedPassword" name="signupEncryptedPassword">
              <div class="field btn">
                <div class="btn-layer"></div>
                <input type="submit" value="Signup">
              </div>
            </form>
          </div>
        </div>
      </div>
      </div>
    </body>
  </main>

<style>
    .nav-wrapper 
    {
    flex: 1;
    }

    nav ul {
    box-sizing: border-box;
    background-color: #333;
    display: flex;
    justify-content: space-between;
    width: 100%;
    font-size: 1.8em;
    list-style-type: none;
    }

    .loginBlock {
      padding-top: 5%;
      padding-left: 35%;
      padding-right: 35%;
    }

    a:hover {
    color: orange;
    text-decoration: underline;
    /* Optional: Add underline on hover */
    }

    nav ul li {
    flex: 1;
    text-align: center;
    }

    nav ul li a {
    color: #fff;
    display: block;
    padding: 20px;
    }

    *{
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    html,body{
      height: 100%;
      width: 100%;
      place-items: center;
                background: url('Mega%20Speedruns_files/bg.png') no-repeat center center fixed;
                background-size: cover;
    }
    ::selection{
      background: #1a75ff;
      color: #fff;
    }
    .wrapper{ 
      overflow: hidden;
      max-width: 100%;
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0px 15px 20px rgba(0,0,0,0.1);
    }
    .wrapper .title-text{
      display: flex;
      width: 200%;
    }
    .wrapper .title{
      width: 50%;
      font-size: 35px;
      font-weight: 600;
      text-align: center;
      transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
    }
    .wrapper .slide-controls{
      position: relative;
      display: flex;
      height: 50px;
      width: 100%;
      overflow: hidden;
      margin: 30px 0 10px 0;
      justify-content: space-between;
      border: 1px solid lightgrey;
      border-radius: 15px;
    }
    .slide-controls .slide{
      height: 100%;
      width: 100%;
      color: #fff;
      font-size: 18px;
      font-weight: 500;
      text-align: center;
      line-height: 48px;
      cursor: pointer;
      z-index: 1;
      transition: all 0.6s ease;
    }
    .slide-controls label.signup{
      color: #000;
    }
    .slide-controls .slider-tab{
      position: absolute;
      height: 100%;
      width: 50%;
      left: 0;
      z-index: 0;
      border-radius: 15px;
      background: -webkit-linear-gradient(left,#003366,#004080,#0059b3
    , #0073e6);
      transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
    }
    input[type="radio"]{
      display: none;
    }
    #signup:checked ~ .slider-tab{
      left: 50%;
    }
    #signup:checked ~ label.signup{
      color: #fff;
      cursor: default;
      user-select: none;
    }
    #signup:checked ~ label.login{
      color: #000;
    }
    #login:checked ~ label.signup{
      color: #000;
    }
    #login:checked ~ label.login{
      cursor: default;
      user-select: none;
    }
    .wrapper .form-container{
      width: 100%;
      overflow: hidden;
    }
    .form-container .form-inner{
      display: flex;
      width: 200%;
    }
    .form-container .form-inner form{
      width: 50%;
      transition: all 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
    }
    .form-inner form .field{
      height: 50px;
      width: 100%;
      margin-top: 20px;
    }
    .form-inner form .field input{
      height: 100%;
      width: 100%;
      outline: none;
      padding-left: 15px;
      border-radius: 15px;
      border: 1px solid lightgrey;
      border-bottom-width: 2px;
      font-size: 17px;
      transition: all 0.3s ease;
    }
    .form-inner form .field input:focus{
      border-color: #1a75ff;
      /* box-shadow: inset 0 0 3px #fb6aae; */
    }
    .form-inner form .field input::placeholder{
      color: #999;
      transition: all 0.3s ease;
    }
    form .field input:focus::placeholder{
      color: #1a75ff;
    }
    .form-inner form .pass-link{
      margin-top: 5px;
    }
    .form-inner form .signup-link{
      text-align: center;
      margin-top: 30px;
    }
    .form-inner form .pass-link a,
    .form-inner form .signup-link a{
      color: #1a75ff;
      text-decoration: none;
    }
    .form-inner form .pass-link a:hover,
    .form-inner form .signup-link a:hover{
      text-decoration: underline;
    }
    form .btn{
      height: 50px;
      width: 100%;
      border-radius: 15px;
      position: relative;
      overflow: hidden;
    }
    form .btn .btn-layer{
      height: 100%;
      width: 300%;
      position: absolute;
      left: -100%;
      background: -webkit-linear-gradient(right,#003366,#004080,#0059b3
    , #0073e6);
      border-radius: 15px;
      transition: all 0.4s ease;;
    }
    form .btn:hover .btn-layer{
      left: 0;
    }
    form .btn input[type="submit"]{
      height: 100%;
      width: 100%;
      z-index: 1;
      position: relative;
      background: none;
      border: none;
      color: #fff;
      padding-left: 0;
      border-radius: 15px;
      font-size: 20px;
      font-weight: 500;
      cursor: pointer;
    }
</style>

<script type="module">
    import './index.js';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    


    const firebaseConfig = {
        apiKey: "AIzaSyC2pHhSThFkKhN-c1sdhUATt1-zmNLV9sw",
        authDomain: "megaspeedrunsdatabase.firebaseapp.com",
        projectId: "megaspeedrunsdatabase",
        storageBucket: "megaspeedrunsdatabase.appspot.com",
        messagingSenderId: "545413984550",
        appId: "1:545413984550:web:79c899026a21f6343091e7"
    };

    const app = initializeApp(firebaseConfig);

    //import { getAuth, createUserWithEmailAndPassword } from "firebase/auth";
    import { getDatabase, ref, child, get, set, update, remove } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    const db = getDatabase();

    let signupUsername = document.getElementById('signupUsername');
    let signupPassword = document.getElementById('signupUsername');
    let loginUsername = document.getElementById('loginUsername');
    let loginPassword = document.getElementById('loginUsername');

    let AddBtn = document.getElementById('AddBtn');
    let RetBtn = document.getElementById('RetBtn');
    let UpdBtn = document.getElementById('UpdBtn');
    let DelBtn = document.getElementById('DelBtn');

    var x = "0";
    var i = "0";

    //New data
{
    const loginText = document.querySelector(".title-text .login");
    const loginForm = document.querySelector("form.login");
    const loginBtn = document.querySelector("label.login");
    const signupBtn = document.querySelector("label.signup");
    const signupLink = document.querySelector("form .signup-link a");

    signupBtn.onclick = () => {
      loginForm.style.marginLeft = "-50%";
      loginText.style.marginLeft = "-50%";
    };

    loginBtn.onclick = () => {
      loginForm.style.marginLeft = "0%";
      loginText.style.marginLeft = "0%";
    };

    signupLink.onclick = () => {
      signupBtn.click();
      return false;
    };
}

// Function to handle signup
function handleSignup() {
        const username = document.getElementById('signupUsername').value;
        const password = document.getElementById('signupPassword').value;

        // You can trigger any event or logic you need when the form is submitted.
        alert(`Signup successful for username: ${username}`);

        // Store user data in Firebase Database (optional)
        const userId = new Date().getTime(); // Unique ID based on timestamp
        set(ref(db, 'Account/' + userId), {
            username: username,
            password: password,  // Storing password in plaintext is not secure; ideally, encrypt it before storing.
            createdAt: new Date().toISOString()
        }).then(() => {
            alert('User account added to the database.');
        }).catch((error) => {
            alert('Error: ' + error.message);
        });
    }

// Modify handleLogin function to update login status
function handleLogin() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    // Query the Firebase database to find users with the provided username
    get(ref(db, 'Account/')).then((snapshot) => {
        let isAuthenticated = false;

        if (snapshot.exists()) {
            snapshot.forEach((childSnapshot) => {
                const userData = childSnapshot.val();
                if (userData.username === username && userData.password === password) {
                    isAuthenticated = true;
                    return true; // Exit the loop once a match is found
                }
            });

            if (isAuthenticated) {
                alert('Login successful!');
                localStorage.setItem('loggedIn', 'true');
                localStorage.setItem('loggedInUser', username);
                displayLoginStatus();  // Update login status on screen
            } else {
                alert('Invalid username or password.');
                localStorage.setItem('loggedIn', 'false');
            }
        } else {
            alert('Username not found.');
            localStorage.setItem('loggedIn', 'false');
        }
    }).catch((error) => {
        alert('Error: ' + error.message);
    });
}

// Call displayLoginStatus() on page load to show the correct status
document.addEventListener('DOMContentLoaded', displayLoginStatus);

// Function to display login status
function displayLoginStatus() {
    const statusDiv = document.getElementById('statusMessage');
    const isLoggedIn = localStorage.getItem('loggedIn');
    
    if (isLoggedIn === 'true') {
        statusDiv.innerHTML = `<p>Welcome, ${localStorage.getItem('loggedInUser')}! You are logged in.</p>`;
    } else {
        statusDiv.innerHTML = `<p>You are not logged in.</p>`;
    }
}

    // Attach the handleSignup function to the signup form submission
    document.getElementById('signupForm').addEventListener('submit', function(event) {
        event.preventDefault();
        handleSignup();
    });

    document.getElementById('loginForm').addEventListener('submit', function(event) {
        event.preventDefault();
        handleLogin();
    });

function AddData() {
            set(ref(db, 'Account/' + x), {
                Username: x
            })
                .then(() => {
                    alert("Account Created Successfully")
                })
                .catch((error) => {
                    alert("Unsuccessful");
                    console.log(error);
                })
        }

    function RetData() {
        const dbRef = ref(db);

        get(child(dbRef, 'SpeedRunner/' + Number(i))).then((snapshot) => {
            if (snapshot.exists()) {

                const info1 = document.createElement("span");
                const info2 = document.createElement("span");
                const info3 = document.createElement("span");
                const info4 = document.createElement("span");
                const info5 = document.createElement("span");

                const list = document.createElement("li");
                list.setAttribute("class", "spacing");

                var str = snapshot.val().Run;
                var newStr = str.replace(/_/g, " ");

                list.innerHTML = '<img src="Mega%20Speedruns_files/' + snapshot.val().Tournament + 'SS/' + snapshot.val().Run + '.png"' + snapshot.val().Run + ' alt="' + newStr + '" class="imgResize">' +
                    '<span>Level: ' + newStr + '</span>' + '<span>Category: ' + snapshot.val().Category + '</span>' +
                    '<span>Runner: ' + snapshot.val().Runner + '</span>' + '<span>Time: ' + snapshot.val().Time + '</span>' +
                    '<span><a href=' + snapshot.val().Link + 'target="_blank">Watch Run</a></span>';

                document.getElementById("allSpeedruns").appendChild(list);
            }
            else
                alert("Error");
            console.log(error);
        })
    }

    function DeleteData() {
        remove(ref(db, 'SpeedRunner/' + Link.value))
            .then(() => {
                alert("Data Deleted Successfully")
            })
            .catch((error) => {
                alert("Unsuccessful");
                console.log(error);
            })
    }

    function UpdateData() {
        update(ref(db, 'SpeedRunner/' + Link.value), {
            Runner: { Runner: Runner.value, Link: Link.value, Time: Time.value },
            Run: Run.value,
            Category: Category.value
        })
            .then(() => {
                alert("Data Updated Successfully")
            })
            .catch((error) => {
                alert("Unsuccessful");
                console.log(error);
            })
    }

</script>
</html>